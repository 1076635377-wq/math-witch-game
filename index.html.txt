<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒäººæ•°å­¦ç‰ˆ - å¥³å·«çš„æ¯’è¯</title>
    <style>
        :root {
            --primary-color: #4a235a;
            --secondary-color: #8e44ad;
            --accent-color: #d4ac0d;
            --potion-color: #27ae60;
            --poison-color: #e74c3c;
            --player1-color: #3498db;
            --player2-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: var(--light-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            max-width: 1200px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--accent-color);
            text-shadow: 0 0 10px rgba(212, 172, 13, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #b8b8b8;
            margin-bottom: 20px;
        }
        
        .teacher-panel {
            background: rgba(44, 62, 80, 0.9);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1200px;
            border: 2px solid var(--accent-color);
        }
        
        .teacher-panel h3 {
            color: var(--accent-color);
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .teacher-panel-content {
            display: none;
            margin-top: 15px;
        }
        
        .question-bank-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .question-bank {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--secondary-color);
        }
        
        .question-bank h4 {
            color: var(--accent-color);
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 10px;
        }
        
        .question-item {
            padding: 8px;
            margin-bottom: 5px;
            background: rgba(44, 62, 80, 0.5);
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .question-item:hover {
            background: rgba(78, 93, 108, 0.5);
        }
        
        .question-item.active {
            background: var(--secondary-color);
        }
        
        .question-editor {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--secondary-color);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--accent-color);
        }
        
        .form-control {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--secondary-color);
            background: rgba(44, 62, 80, 0.8);
            color: white;
        }
        
        textarea.form-control {
            min-height: 80px;
            resize: vertical;
        }
        
        .option-row {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .option-row input[type="radio"] {
            margin-right: 10px;
        }
        
        .option-row input[type="text"] {
            flex: 1;
        }
        
        .btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 5px;
        }
        
        .btn:hover {
            background: var(--primary-color);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: var(--potion-color);
        }
        
        .btn-danger {
            background: var(--poison-color);
        }
        
        .btn-large {
            font-size: 1.5rem;
            padding: 15px 40px;
        }
        
        .start-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            width: 100%;
            max-width: 1200px;
        }
        
        .timer-container {
            background: rgba(44, 62, 80, 0.7);
            border-radius: 10px;
            padding: 15px 30px;
            margin-bottom: 20px;
            border: 2px solid var(--accent-color);
            display: flex;
            align-items: center;
            gap: 15px;
            display: none; /* åˆå§‹éšè—ï¼Œæ¸¸æˆå¼€å§‹åæ˜¾ç¤º */
        }
        
        .timer-icon {
            font-size: 2rem;
        }
        
        .timer-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }
        
        .timer-warning {
            color: var(--poison-color);
            animation: pulse 1s infinite;
        }
        
        .game-container {
            display: flex;
            flex-direction: row;
            width: 100%;
            max-width: 1200px;
            gap: 20px;
            margin-bottom: 20px;
            display: none; /* åˆå§‹éšè—ï¼Œæ¸¸æˆå¼€å§‹åæ˜¾ç¤º */
        }
        
        .player-area {
            flex: 1;
            background: rgba(44, 62, 80, 0.7);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
        }
        
        .player1 {
            border: 2px solid var(--player1-color);
        }
        
        .player2 {
            border: 2px solid var(--player2-color);
        }
        
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .player-name {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .player1 .player-name {
            color: var(--player1-color);
        }
        
        .player2 .player-name {
            color: var(--player2-color);
        }
        
        .player-score {
            font-size: 1.2rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .progress-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            position: relative;
        }
        
        .progress-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }
        
        .progress-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 8px;
            background: var(--dark-color);
            border: 2px solid var(--secondary-color);
            transition: all 0.3s ease;
        }
        
        .progress-icon.active {
            background: var(--secondary-color);
            box-shadow: 0 0 15px var(--secondary-color);
        }
        
        .progress-icon.potion {
            border-color: var(--potion-color);
        }
        
        .progress-icon.potion.active {
            background: var(--potion-color);
            box-shadow: 0 0 15px var(--potion-color);
        }
        
        .progress-icon.poison {
            border-color: var(--poison-color);
        }
        
        .progress-icon.poison.active {
            background: var(--poison-color);
            box-shadow: 0 0 15px var(--poison-color);
        }
        
        .progress-bar {
            position: absolute;
            top: 25px;
            left: 10%;
            width: 80%;
            height: 4px;
            background: var(--dark-color);
            z-index: 1;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--secondary-color);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .question-container {
            background: rgba(26, 26, 46, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--primary-color);
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .question-text {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .option {
            background: rgba(44, 62, 80, 0.8);
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
        }
        
        .option:hover {
            background: rgba(78, 93, 108, 0.8);
            transform: translateY(-3px);
        }
        
        .option.correct {
            background: var(--potion-color);
            border-color: var(--potion-color);
            animation: pulse 0.5s ease;
        }
        
        .option.incorrect {
            background: var(--poison-color);
            border-color: var(--poison-color);
            animation: shake 0.5s ease;
        }
        
        .feedback-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 150px;
            margin: 10px 0;
        }
        
        .feedback-item {
            text-align: center;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 10px;
            animation: bounce 1s ease infinite;
        }
        
        .potion-feedback .feedback-icon {
            color: var(--potion-color);
            text-shadow: 0 0 20px rgba(39, 174, 96, 0.7);
        }
        
        .poison-feedback .feedback-icon {
            color: var(--poison-color);
            text-shadow: 0 0 20px rgba(231, 76, 60, 0.7);
        }
        
        .feedback-text {
            font-size: 1.3rem;
            font-weight: bold;
        }
        
        .potion-feedback .feedback-text {
            color: var(--potion-color);
        }
        
        .poison-feedback .feedback-text {
            color: var(--poison-color);
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: auto;
        }
        
        .game-over {
            text-align: center;
            padding: 30px;
            display: none;
            width: 100%;
            max-width: 800px;
            background: rgba(44, 62, 80, 0.9);
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--accent-color);
        }
        
        .game-over p {
            font-size: 1.2rem;
            margin-bottom: 25px;
        }
        
        .cauldron-container {
            font-size: 8rem;
            margin: 20px 0;
            animation: float 3s ease-in-out infinite;
        }
        
        .winner-announcement {
            font-size: 2rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .player1-winner {
            color: var(--player1-color);
            border: 2px solid var(--player1-color);
        }
        
        .player2-winner {
            color: var(--player2-color);
            border: 2px solid var(--player2-color);
        }
        
        .draw {
            color: var(--accent-color);
            border: 2px solid var(--accent-color);
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        @media (max-width: 900px) {
            .game-container {
                flex-direction: column;
            }
            
            .player-area {
                width: 100%;
            }
            
            .question-bank-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .feedback-icon {
                font-size: 3rem;
            }
            
            .cauldron-container {
                font-size: 5rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>åŒäººæ•°å­¦ç‰ˆ - å¥³å·«çš„æ¯’è¯</h1>
        <p class="subtitle">ä¸å¯¹æ‰‹ç«äº‰ï¼Œåœ¨æ—¶é—´ç»“æŸå‰æ”¶é›†æ›´å¤šè§£è¯æˆåˆ†ï¼</p>
    </header>
    
    <!-- æ•™å¸ˆé¢æ¿ -->
    <div class="teacher-panel">
        <h3>
            <span>æ•™å¸ˆé¢æ¿ - é¢˜åº“ç®¡ç†</span>
            <button id="toggleTeacherPanel" class="btn">æ˜¾ç¤ºé¢æ¿</button>
        </h3>
        <div class="teacher-panel-content" id="teacherPanelContent">
            <div class="question-bank-container">
                <div class="question-bank">
                    <h4>å½“å‰é¢˜åº“</h4>
                    <div class="question-list" id="questionList">
                        <!-- é—®é¢˜åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    <div>
                        <button id="addQuestionBtn" class="btn btn-success">æ·»åŠ æ–°é¢˜ç›®</button>
                        <button id="loadDefaultBtn" class="btn">åŠ è½½é»˜è®¤é¢˜åº“</button>
                    </div>
                </div>
                <div class="question-editor">
                    <h4>é¢˜ç›®ç¼–è¾‘å™¨</h4>
                    <div class="form-group">
                        <label for="questionText">é—®é¢˜å†…å®¹</label>
                        <textarea id="questionText" class="form-control" placeholder="è¾“å…¥é—®é¢˜å†…å®¹..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>é€‰é¡¹ (é€‰æ‹©æ­£ç¡®ç­”æ¡ˆ)</label>
                        <div class="option-row">
                            <input type="radio" name="correctAnswer" value="0" checked>
                            <input type="text" id="option0" class="form-control" placeholder="é€‰é¡¹ A">
                        </div>
                        <div class="option-row">
                            <input type="radio" name="correctAnswer" value="1">
                            <input type="text" id="option1" class="form-control" placeholder="é€‰é¡¹ B">
                        </div>
                        <div class="option-row">
                            <input type="radio" name="correctAnswer" value="2">
                            <input type="text" id="option2" class="form-control" placeholder="é€‰é¡¹ C">
                        </div>
                        <div class="option-row">
                            <input type="radio" name="correctAnswer" value="3">
                            <input type="text" id="option3" class="form-control" placeholder="é€‰é¡¹ D">
                        </div>
                    </div>
                    <div>
                        <button id="saveQuestionBtn" class="btn btn-success">ä¿å­˜é¢˜ç›®</button>
                        <button id="deleteQuestionBtn" class="btn btn-danger">åˆ é™¤é¢˜ç›®</button>
                        <button id="applyQuestionsBtn" class="btn">åº”ç”¨é¢˜åº“åˆ°æ¸¸æˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¼€å§‹æŒ‰é’®å®¹å™¨ -->
    <div class="start-container">
        <button id="startGameBtn" class="btn btn-success btn-large">å¼€å§‹æ¸¸æˆ</button>
    </div>
    
    <!-- è®¡æ—¶å™¨å®¹å™¨ -->
    <div class="timer-container" id="timerContainer">
        <div class="timer-icon">â±ï¸</div>
        <div class="timer-text" id="timer">05:00</div>
    </div>
    
    <!-- æ¸¸æˆå®¹å™¨ -->
    <div class="game-container" id="gameContainer">
        <!-- ç©å®¶1åŒºåŸŸ -->
        <div class="player-area player1">
            <div class="player-header">
                <div class="player-name">ç©å®¶ 1</div>
                <div class="player-score">å¾—åˆ†: <span id="player1Score">0</span></div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="player1ProgressFill"></div>
                </div>
                <div class="progress-item">
                    <div class="progress-icon potion" id="player1Potion1">ğŸ§ª</div>
                    <span>è§£è¯1</span>
                </div>
                <div class="progress-item">
                    <div class="progress-icon potion" id="player1Potion2">ğŸ§ª</div>
                    <span>è§£è¯2</span>
                </div>
                <div class="progress-item">
                    <div class="progress-icon potion" id="player1Potion3">ğŸ§ª</div>
                    <span>è§£è¯3</span>
                </div>
                <div class="progress-item">
                    <div class="progress-icon poison" id="player1Poison">â˜ ï¸</div>
                    <span>æ¯’è¯</span>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="player1QuestionText">é—®é¢˜å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                <div class="options-container" id="player1OptionsContainer">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="feedback-container" id="player1FeedbackContainer">
                <div class="feedback-item potion-feedback" id="player1PotionFeedback">
                    <div class="feedback-icon">ğŸ§ª</div>
                    <div class="feedback-text">è§£è¯æˆåˆ†æ”¶é›†æˆåŠŸï¼</div>
                </div>
                <div class="feedback-item poison-feedback" id="player1PoisonFeedback">
                    <div class="feedback-icon">â˜ ï¸</div>
                    <div class="feedback-text">ç³Ÿç³•ï¼ä½ è·å¾—äº†æ¯’è¯ï¼</div>
                </div>
            </div>
            
            <div class="controls">
                <button id="player1PrevBtn" disabled>ä¸Šä¸€é¢˜</button>
                <button id="player1NextBtn">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
        
        <!-- ç©å®¶2åŒºåŸŸ -->
        <div class="player-area player2">
            <div class="player-header">
                <div class="player-name">ç©å®¶ 2</div>
                <div class="player-score">å¾—åˆ†: <span id="player2Score">0</span></div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="player2ProgressFill"></div>
                </div>
                <div class="progress-item">
                    <div class="progress-icon potion" id="player2Potion1">ğŸ§ª</div>
                    <span>è§£è¯1</span>
                </div>
                <div class="progress-item">
                    <div class="progress-icon potion" id="player2Potion2">ğŸ§ª</div>
                    <span>è§£è¯2</span>
                </div>
                <div class="progress-item">
                    <div class="progress-icon potion" id="player2Potion3">ğŸ§ª</div>
                    <span>è§£è¯3</span>
                </div>
                <div class="progress-item">
                    <div class="progress-icon poison" id="player2Poison">â˜ ï¸</div>
                    <span>æ¯’è¯</span>
                </div>
            </div>
            
            <div class="question-container">
                <div class="question-text" id="player2QuestionText">é—®é¢˜å°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                <div class="options-container" id="player2OptionsContainer">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="feedback-container" id="player2FeedbackContainer">
                <div class="feedback-item potion-feedback" id="player2PotionFeedback">
                    <div class="feedback-icon">ğŸ§ª</div>
                    <div class="feedback-text">è§£è¯æˆåˆ†æ”¶é›†æˆåŠŸï¼</div>
                </div>
                <div class="feedback-item poison-feedback" id="player2PoisonFeedback">
                    <div class="feedback-icon">â˜ ï¸</div>
                    <div class="feedback-text">ç³Ÿç³•ï¼ä½ è·å¾—äº†æ¯’è¯ï¼</div>
                </div>
            </div>
            
            <div class="controls">
                <button id="player2PrevBtn" disabled>ä¸Šä¸€é¢˜</button>
                <button id="player2NextBtn">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
    </div>
    
    <div class="game-over" id="gameOver">
        <h2 id="gameResultTitle">æ¸¸æˆç»“æŸ</h2>
        <div class="cauldron-container" id="cauldron">ğŸ§ª</div>
        <div class="winner-announcement" id="winnerAnnouncement"></div>
        <p id="gameResultText"></p>
        <button id="restartBtn">é‡æ–°å¼€å§‹æ¸¸æˆ</button>
    </div>

    <script>
        // æ–°çš„æ•°å­¦é¢˜åº“ - æ ¹æ®æ‚¨æä¾›çš„é¢˜ç›®æ”¹ç¼–
        const defaultQuestions = [
            {
                question: "ä¸‹åˆ—å„å¼ä¸­ï¼Œæ˜¯ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹çš„æœ‰______ï¼ˆè¯·é€‰æ‹©æ‰€æœ‰æ­£ç¡®é€‰é¡¹ï¼‰",
                options: ["(1)å’Œ(3)", "(2)å’Œ(4)", "(1)å’Œ(5)", "(3)å’Œ(6)"],
                correctAnswer: 0
            },
            {
                question: "x=2 ______ æ–¹ç¨‹4x-1=3çš„è§£ã€‚",
                options: ["æ˜¯", "ä¸æ˜¯"],
                correctAnswer: 1
            },
            {
                question: "è‹¥æ–¹ç¨‹(a-b)y+x^a+4=3æ˜¯å…³äºxçš„ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹ï¼Œåˆ™a=______ï¼Œb=______ã€‚",
                options: ["a=1, b=1", "a=1, b=0", "a=0, b=1", "a=1, b=ä»»æ„æ•°"],
                correctAnswer: 0
            },
            {
                question: "è‹¥å…³äºxçš„æ–¹ç¨‹5m+3x=1+xçš„è§£æ¯”æ–¹ç¨‹2x=6çš„è§£å°1ï¼Œåˆ™m=______ã€‚",
                options: ["-3/5", "3/5", "-5/3", "5/3"],
                correctAnswer: 0
            },
            {
                question: "å¯¹äºæœ‰ç†æ•°a,bè§„å®šä¸€ç§æ–°è¿ç®—ï¼ša*b=ab+bï¼Œä¾‹å¦‚ï¼š2*3=2Ã—3+3=9ï¼Œè‹¥æ–¹ç¨‹(x-4)*3=6çš„è§£ä¸ºx=5ï¼Œåˆ™a=______ã€‚",
                options: ["6", "9", "15", "3"],
                correctAnswer: 0
            },
            {
                question: "ä¸‹åˆ—å“ªä¸ªæ˜¯ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹ï¼Ÿ",
                options: ["3x+8=3", "18-x", "5xÂ²=20", "x+y=8"],
                correctAnswer: 0
            },
            {
                question: "æ–¹ç¨‹3x+5=3x+2çš„è§£çš„æƒ…å†µæ˜¯ï¼Ÿ",
                options: ["æ— è§£", "æœ‰å”¯ä¸€è§£", "æœ‰æ— æ•°è§£", "x=0"],
                correctAnswer: 0
            },
            {
                question: "è‹¥x=3æ˜¯æ–¹ç¨‹2x-a=7çš„è§£ï¼Œåˆ™açš„å€¼æ˜¯ï¼Ÿ",
                options: ["-1", "1", "5", "-5"],
                correctAnswer: 0
            },
            {
                question: "è§£æ–¹ç¨‹ï¼š2(x-3) = 4x + 6",
                options: ["x = -6", "x = 6", "x = 0", "x = -3"],
                correctAnswer: 0
            },
            {
                question: "ä¸‹åˆ—å“ªä¸ªä¸æ˜¯ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹ï¼Ÿ",
                options: ["2x + 3 = 7", "xÂ² + 2x = 0", "5y - 1 = 9", "3z = 12"],
                correctAnswer: 1
            },
            {
                question: "è‹¥2x - 5 = 3ï¼Œåˆ™xçš„å€¼æ˜¯ï¼Ÿ",
                options: ["4", "3", "2", "1"],
                correctAnswer: 0
            },
            {
                question: "æ–¹ç¨‹3(x+2) = 15çš„è§£æ˜¯ï¼Ÿ",
                options: ["x = 3", "x = 5", "x = 1", "x = 7"],
                correctAnswer: 0
            }
        ];

        // æ¸¸æˆçŠ¶æ€
        let currentQuestions = [...defaultQuestions];
        let gameActive = false; // åˆå§‹ä¸ºfalseï¼Œç­‰å¾…å¼€å§‹æŒ‰é’®
        let timeLeft = 300; // 5åˆ†é’Ÿï¼Œå•ä½ï¼šç§’
        let timerInterval;
        let currentEditingIndex = -1; // å½“å‰ç¼–è¾‘çš„é¢˜ç›®ç´¢å¼•ï¼Œ-1è¡¨ç¤ºæ–°å»º
        
        // ç©å®¶1çŠ¶æ€
        let player1 = {
            currentQuestionIndex: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            selectedOption: null,
            answerSubmitted: false,
            questionSequence: [] // ç©å®¶1çš„é¢˜ç›®åºåˆ—
        };
        
        // ç©å®¶2çŠ¶æ€
        let player2 = {
            currentQuestionIndex: 0,
            correctAnswers: 0,
            wrongAnswers: 0,
            selectedOption: null,
            answerSubmitted: false,
            questionSequence: [] // ç©å®¶2çš„é¢˜ç›®åºåˆ—
        };

        // DOMå…ƒç´ 
        const timer = document.getElementById('timer');
        const timerContainer = document.getElementById('timerContainer');
        const gameContainer = document.getElementById('gameContainer');
        const startGameBtn = document.getElementById('startGameBtn');
        
        // æ•™å¸ˆé¢æ¿ç›¸å…³å…ƒç´ 
        const toggleTeacherPanel = document.getElementById('toggleTeacherPanel');
        const teacherPanelContent = document.getElementById('teacherPanelContent');
        const questionList = document.getElementById('questionList');
        const addQuestionBtn = document.getElementById('addQuestionBtn');
        const loadDefaultBtn = document.getElementById('loadDefaultBtn');
        const questionText = document.getElementById('questionText');
        const option0 = document.getElementById('option0');
        const option1 = document.getElementById('option1');
        const option2 = document.getElementById('option2');
        const option3 = document.getElementById('option3');
        const saveQuestionBtn = document.getElementById('saveQuestionBtn');
        const deleteQuestionBtn = document.getElementById('deleteQuestionBtn');
        const applyQuestionsBtn = document.getElementById('applyQuestionsBtn');
        
        // ç©å®¶1 DOMå…ƒç´ 
        const player1QuestionText = document.getElementById('player1QuestionText');
        const player1OptionsContainer = document.getElementById('player1OptionsContainer');
        const player1PrevBtn = document.getElementById('player1PrevBtn');
        const player1NextBtn = document.getElementById('player1NextBtn');
        const player1ProgressFill = document.getElementById('player1ProgressFill');
        const player1Potion1 = document.getElementById('player1Potion1');
        const player1Potion2 = document.getElementById('player1Potion2');
        const player1Potion3 = document.getElementById('player1Potion3');
        const player1Poison = document.getElementById('player1Poison');
        const player1PotionFeedback = document.getElementById('player1PotionFeedback');
        const player1PoisonFeedback = document.getElementById('player1PoisonFeedback');
        const player1Score = document.getElementById('player1Score');
        
        // ç©å®¶2 DOMå…ƒç´ 
        const player2QuestionText = document.getElementById('player2QuestionText');
        const player2OptionsContainer = document.getElementById('player2OptionsContainer');
        const player2PrevBtn = document.getElementById('player2PrevBtn');
        const player2NextBtn = document.getElementById('player2NextBtn');
        const player2ProgressFill = document.getElementById('player2ProgressFill');
        const player2Potion1 = document.getElementById('player2Potion1');
        const player2Potion2 = document.getElementById('player2Potion2');
        const player2Potion3 = document.getElementById('player2Potion3');
        const player2Poison = document.getElementById('player2Poison');
        const player2PotionFeedback = document.getElementById('player2PotionFeedback');
        const player2PoisonFeedback = document.getElementById('player2PoisonFeedback');
        const player2Score = document.getElementById('player2Score');
        
        // æ¸¸æˆç»“æŸç›¸å…³å…ƒç´ 
        const gameOver = document.getElementById('gameOver');
        const gameResultTitle = document.getElementById('gameResultTitle');
        const gameResultText = document.getElementById('gameResultText');
        const restartBtn = document.getElementById('restartBtn');
        const cauldron = document.getElementById('cauldron');
        const winnerAnnouncement = document.getElementById('winnerAnnouncement');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameActive = false; // ç­‰å¾…å¼€å§‹æŒ‰é’®
            timeLeft = 300;
            clearInterval(timerInterval);
            
            // ä¸ºæ¯ä¸ªç©å®¶ç”Ÿæˆç‹¬ç«‹çš„é¢˜ç›®åºåˆ—
            generateQuestionSequences();
            
            // é‡ç½®ç©å®¶çŠ¶æ€
            player1 = {
                currentQuestionIndex: 0,
                correctAnswers: 0,
                wrongAnswers: 0,
                selectedOption: null,
                answerSubmitted: false,
                questionSequence: player1.questionSequence // ä¿ç•™é¢˜ç›®åºåˆ—
            };
            
            player2 = {
                currentQuestionIndex: 0,
                correctAnswers: 0,
                wrongAnswers: 0,
                selectedOption: null,
                answerSubmitted: false,
                questionSequence: player2.questionSequence // ä¿ç•™é¢˜ç›®åºåˆ—
            };
            
            // æ›´æ–°UI
            updatePlayerProgress(player1, 'player1');
            updatePlayerProgress(player2, 'player2');
            displayPlayerQuestion(player1, 'player1');
            displayPlayerQuestion(player2, 'player2');
            updatePlayerButtons(player1, 'player1');
            updatePlayerButtons(player2, 'player2');
            hidePlayerFeedback('player1');
            hidePlayerFeedback('player2');
            
            // éšè—æ¸¸æˆåŒºåŸŸï¼Œæ˜¾ç¤ºå¼€å§‹æŒ‰é’®
            gameOver.style.display = 'none';
            gameContainer.style.display = 'none';
            timerContainer.style.display = 'none';
            startGameBtn.style.display = 'block';
            
            // æ›´æ–°é¢˜åº“æ˜¾ç¤º
            updateQuestionList();
        }

        // ä¸ºæ¯ä¸ªç©å®¶ç”Ÿæˆç‹¬ç«‹çš„é¢˜ç›®åºåˆ—
        function generateQuestionSequences() {
            // åˆ›å»ºé¢˜åº“çš„å‰¯æœ¬
            const questionsCopy = [...currentQuestions];
            
            // ä¸ºç©å®¶1ç”Ÿæˆé¢˜ç›®åºåˆ—ï¼ˆéšæœºæ’åºï¼‰
            player1.questionSequence = [...questionsCopy];
            shuffleArray(player1.questionSequence);
            
            // ä¸ºç©å®¶2ç”Ÿæˆé¢˜ç›®åºåˆ—ï¼ˆéšæœºæ’åºï¼‰
            player2.questionSequence = [...questionsCopy];
            shuffleArray(player2.questionSequence);
        }

        // éšæœºæ‰“ä¹±æ•°ç»„ï¼ˆFisher-Yatesç®—æ³•ï¼‰
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            gameActive = true;
            startGameBtn.style.display = 'none';
            timerContainer.style.display = 'flex';
            gameContainer.style.display = 'flex';
            startTimer();
        }

        // å¼€å§‹å€’è®¡æ—¶
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    endGame();
                } else if (timeLeft <= 30) {
                    timer.classList.add('timer-warning');
                }
            }, 1000);
        }

        // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // æ˜¾ç¤ºç©å®¶é—®é¢˜
        function displayPlayerQuestion(player, playerId) {
            // ä»ç©å®¶çš„é¢˜ç›®åºåˆ—ä¸­è·å–å½“å‰é¢˜ç›®
            const currentQuestion = player.questionSequence[player.currentQuestionIndex];
            const questionText = document.getElementById(`${playerId}QuestionText`);
            const optionsContainer = document.getElementById(`${playerId}OptionsContainer`);
            
            questionText.textContent = currentQuestion.question;
            
            optionsContainer.innerHTML = '';
            currentQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                optionElement.addEventListener('click', () => selectPlayerOption(optionElement, player, playerId));
                optionsContainer.appendChild(optionElement);
            });
            
            hidePlayerFeedback(playerId);
            player.answerSubmitted = false;
            player.selectedOption = null;
        }

        // é€‰æ‹©ç©å®¶é€‰é¡¹
        function selectPlayerOption(optionElement, player, playerId) {
            if (!gameActive || player.answerSubmitted) return;
            
            // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll(`#${playerId}OptionsContainer .option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // è®¾ç½®æ–°é€‰æ‹©
            optionElement.classList.add('selected');
            player.selectedOption = parseInt(optionElement.dataset.index);
            
            // ç«‹å³æäº¤ç­”æ¡ˆå¹¶æ˜¾ç¤ºåé¦ˆ
            submitPlayerAnswer(player, playerId);
        }

        // æäº¤ç©å®¶ç­”æ¡ˆ
        function submitPlayerAnswer(player, playerId) {
            if (player.selectedOption === null || player.answerSubmitted) return;
            
            player.answerSubmitted = true;
            // ä»ç©å®¶çš„é¢˜ç›®åºåˆ—ä¸­è·å–å½“å‰é¢˜ç›®
            const currentQuestion = player.questionSequence[player.currentQuestionIndex];
            const isCorrect = player.selectedOption === currentQuestion.correctAnswer;
            
            // é«˜äº®æ˜¾ç¤ºæ­£ç¡®å’Œé”™è¯¯ç­”æ¡ˆ
            document.querySelectorAll(`#${playerId}OptionsContainer .option`).forEach((option, index) => {
                if (index === currentQuestion.correctAnswer) {
                    option.classList.add('correct');
                } else if (index === player.selectedOption && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
            
            // æ˜¾ç¤ºåé¦ˆ
            if (isCorrect) {
                player.correctAnswers++;
                showPlayerPotionFeedback(playerId);
            } else {
                player.wrongAnswers++;
                showPlayerPoisonFeedback(playerId);
            }
            
            updatePlayerProgress(player, playerId);
        }

        // æ˜¾ç¤ºç©å®¶è§£è¯åé¦ˆ
        function showPlayerPotionFeedback(playerId) {
            document.getElementById(`${playerId}PotionFeedback`).style.display = 'block';
            document.getElementById(`${playerId}PoisonFeedback`).style.display = 'none';
        }

        // æ˜¾ç¤ºç©å®¶æ¯’è¯åé¦ˆ
        function showPlayerPoisonFeedback(playerId) {
            document.getElementById(`${playerId}PoisonFeedback`).style.display = 'block';
            document.getElementById(`${playerId}PotionFeedback`).style.display = 'none';
        }

        // éšè—ç©å®¶åé¦ˆ
        function hidePlayerFeedback(playerId) {
            document.getElementById(`${playerId}PotionFeedback`).style.display = 'none';
            document.getElementById(`${playerId}PoisonFeedback`).style.display = 'none';
        }

        // æ›´æ–°ç©å®¶è¿›åº¦
        function updatePlayerProgress(player, playerId) {
            // æ›´æ–°è¿›åº¦æ¡
            const progressFill = document.getElementById(`${playerId}ProgressFill`);
            const progressPercentage = (player.currentQuestionIndex / (player.questionSequence.length - 1)) * 80;
            progressFill.style.width = `${progressPercentage}%`;
            
            // æ›´æ–°è§£è¯å’Œæ¯’è¯å›¾æ ‡
            document.getElementById(`${playerId}Potion1`).className = 
                player.correctAnswers >= 1 ? 'progress-icon potion active' : 'progress-icon potion';
            document.getElementById(`${playerId}Potion2`).className = 
                player.correctAnswers >= 2 ? 'progress-icon potion active' : 'progress-icon potion';
            document.getElementById(`${playerId}Potion3`).className = 
                player.correctAnswers >= 3 ? 'progress-icon potion active' : 'progress-icon potion';
            document.getElementById(`${playerId}Poison`).className = 
                player.wrongAnswers >= 1 ? 'progress-icon poison active' : 'progress-icon poison';
            
            // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            document.getElementById(`${playerId}Score`).textContent = player.correctAnswers;
        }

        // æ›´æ–°ç©å®¶æŒ‰é’®çŠ¶æ€
        function updatePlayerButtons(player, playerId) {
            const prevBtn = document.getElementById(`${playerId}PrevBtn`);
            const nextBtn = document.getElementById(`${playerId}NextBtn`);
            
            prevBtn.disabled = player.currentQuestionIndex === 0;
            
            if (player.currentQuestionIndex === player.questionSequence.length - 1) {
                nextBtn.textContent = 'æœ€åä¸€é¢˜';
            } else {
                nextBtn.textContent = 'ä¸‹ä¸€é¢˜';
            }
        }

        // ç©å®¶ä¸‹ä¸€é¢˜
        function playerNextQuestion(player, playerId) {
            if (player.currentQuestionIndex < player.questionSequence.length - 1) {
                player.currentQuestionIndex++;
                displayPlayerQuestion(player, playerId);
                updatePlayerButtons(player, playerId);
            }
        }

        // ç©å®¶ä¸Šä¸€é¢˜
        function playerPrevQuestion(player, playerId) {
            if (player.currentQuestionIndex > 0) {
                player.currentQuestionIndex--;
                displayPlayerQuestion(player, playerId);
                updatePlayerButtons(player, playerId);
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            
            document.querySelector('.game-container').style.display = 'none';
            gameOver.style.display = 'block';
            
            // åˆ¤æ–­èƒœè´Ÿ
            let resultText = '';
            let winnerClass = '';
            
            if (player1.correctAnswers > player2.correctAnswers) {
                resultText = `ç©å®¶1è·èƒœï¼æ”¶é›†äº†${player1.correctAnswers}ä¸ªè§£è¯æˆåˆ†ï¼`;
                winnerClass = 'player1-winner';
            } else if (player2.correctAnswers > player1.correctAnswers) {
                resultText = `ç©å®¶2è·èƒœï¼æ”¶é›†äº†${player2.correctAnswers}ä¸ªè§£è¯æˆåˆ†ï¼`;
                winnerClass = 'player2-winner';
            } else {
                resultText = `å¹³å±€ï¼åŒæ–¹éƒ½æ”¶é›†äº†${player1.correctAnswers}ä¸ªè§£è¯æˆåˆ†ï¼`;
                winnerClass = 'draw';
            }
            
            // æ˜¾ç¤ºæ¯’è¯å©åŸš
            cauldron.textContent = 'ğŸ§ª';
            
            // æ˜¾ç¤ºç»“æœ
            gameResultTitle.textContent = "æ—¶é—´åˆ°ï¼æ¸¸æˆç»“æŸï¼";
            winnerAnnouncement.textContent = resultText;
            winnerAnnouncement.className = `winner-announcement ${winnerClass}`;
            gameResultText.textContent = `ç©å®¶1: ${player1.correctAnswers}ä¸ªè§£è¯ | ç©å®¶2: ${player2.correctAnswers}ä¸ªè§£è¯`;
        }

        // æ•™å¸ˆé¢æ¿åŠŸèƒ½
        function toggleTeacherPanelView() {
            if (teacherPanelContent.style.display === 'block') {
                teacherPanelContent.style.display = 'none';
                toggleTeacherPanel.textContent = 'æ˜¾ç¤ºé¢æ¿';
            } else {
                teacherPanelContent.style.display = 'block';
                toggleTeacherPanel.textContent = 'éšè—é¢æ¿';
                updateQuestionList();
            }
        }

        // æ›´æ–°é¢˜ç›®åˆ—è¡¨
        function updateQuestionList() {
            questionList.innerHTML = '';
            currentQuestions.forEach((question, index) => {
                const questionItem = document.createElement('div');
                questionItem.className = 'question-item';
                if (index === currentEditingIndex) {
                    questionItem.classList.add('active');
                }
                questionItem.textContent = `${index + 1}. ${question.question.substring(0, 50)}${question.question.length > 50 ? '...' : ''}`;
                questionItem.addEventListener('click', () => editQuestion(index));
                questionList.appendChild(questionItem);
            });
        }

        // ç¼–è¾‘é¢˜ç›®
        function editQuestion(index) {
            currentEditingIndex = index;
            const question = currentQuestions[index];
            
            questionText.value = question.question;
            option0.value = question.options[0];
            option1.value = question.options[1];
            option2.value = question.options[2];
            option3.value = question.options[3];
            
            // è®¾ç½®æ­£ç¡®ç­”æ¡ˆ
            document.querySelector(`input[name="correctAnswer"][value="${question.correctAnswer}"]`).checked = true;
            
            updateQuestionList();
        }

        // æ·»åŠ æ–°é¢˜ç›®
        function addNewQuestion() {
            currentEditingIndex = -1;
            questionText.value = '';
            option0.value = '';
            option1.value = '';
            option2.value = '';
            option3.value = '';
            document.querySelector('input[name="correctAnswer"][value="0"]').checked = true;
            updateQuestionList();
        }

        // ä¿å­˜é¢˜ç›®
        function saveQuestion() {
            const questionValue = questionText.value.trim();
            const option0Value = option0.value.trim();
            const option1Value = option1.value.trim();
            const option2Value = option2.value.trim();
            const option3Value = option3.value.trim();
            const correctAnswerValue = parseInt(document.querySelector('input[name="correctAnswer"]:checked').value);
            
            if (!questionValue || !option0Value || !option1Value || !option2Value || !option3Value) {
                alert('è¯·å¡«å†™å®Œæ•´çš„é—®é¢˜å’Œæ‰€æœ‰é€‰é¡¹ï¼');
                return;
            }
            
            const question = {
                question: questionValue,
                options: [option0Value, option1Value, option2Value, option3Value],
                correctAnswer: correctAnswerValue
            };
            
            if (currentEditingIndex === -1) {
                // æ·»åŠ æ–°é¢˜ç›®
                currentQuestions.push(question);
            } else {
                // æ›´æ–°ç°æœ‰é¢˜ç›®
                currentQuestions[currentEditingIndex] = question;
            }
            
            updateQuestionList();
            alert('é¢˜ç›®å·²ä¿å­˜ï¼');
        }

        // åˆ é™¤é¢˜ç›®
        function deleteQuestion() {
            if (currentEditingIndex === -1) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¢˜ç›®è¿›è¡Œåˆ é™¤ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé¢˜ç›®å—ï¼Ÿ')) {
                currentQuestions.splice(currentEditingIndex, 1);
                currentEditingIndex = -1;
                questionText.value = '';
                option0.value = '';
                option1.value = '';
                option2.value = '';
                option3.value = '';
                document.querySelector('input[name="correctAnswer"][value="0"]').checked = true;
                updateQuestionList();
                alert('é¢˜ç›®å·²åˆ é™¤ï¼');
            }
        }

        // åŠ è½½é»˜è®¤é¢˜åº“
        function loadDefaultQuestions() {
            if (confirm('ç¡®å®šè¦åŠ è½½é»˜è®¤é¢˜åº“å—ï¼Ÿå½“å‰é¢˜åº“å°†è¢«æ›¿æ¢ã€‚')) {
                currentQuestions = [...defaultQuestions];
                updateQuestionList();
                alert('é»˜è®¤é¢˜åº“å·²åŠ è½½ï¼');
            }
        }

        // åº”ç”¨é¢˜åº“åˆ°æ¸¸æˆ
        function applyQuestionsToGame() {
            if (currentQuestions.length === 0) {
                alert('é¢˜åº“ä¸ºç©ºï¼Œè¯·å…ˆæ·»åŠ é¢˜ç›®ï¼');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åº”ç”¨å½“å‰é¢˜åº“åˆ°æ¸¸æˆå—ï¼Ÿæ¸¸æˆå°†é‡æ–°å¼€å§‹ã€‚')) {
                initGame();
                alert('é¢˜åº“å·²åº”ç”¨åˆ°æ¸¸æˆï¼');
            }
        }

        // äº‹ä»¶ç›‘å¬
        player1NextBtn.addEventListener('click', () => playerNextQuestion(player1, 'player1'));
        player1PrevBtn.addEventListener('click', () => playerPrevQuestion(player1, 'player1'));
        player2NextBtn.addEventListener('click', () => playerNextQuestion(player2, 'player2'));
        player2PrevBtn.addEventListener('click', () => playerPrevQuestion(player2, 'player2'));
        restartBtn.addEventListener('click', initGame);
        startGameBtn.addEventListener('click', startGame);
        
        // æ•™å¸ˆé¢æ¿äº‹ä»¶ç›‘å¬
        toggleTeacherPanel.addEventListener('click', toggleTeacherPanelView);
        addQuestionBtn.addEventListener('click', addNewQuestion);
        loadDefaultBtn.addEventListener('click', loadDefaultQuestions);
        saveQuestionBtn.addEventListener('click', saveQuestion);
        deleteQuestionBtn.addEventListener('click', deleteQuestion);
        applyQuestionsBtn.addEventListener('click', applyQuestionsToGame);

        // åˆå§‹åŒ–æ¸¸æˆ
        initGame();
    </script>
</body>
</html>